@model Blackjack.Web.Models.BlackjackViewModel
@{
    decimal vinst;
    if (Model.Payout == 0 && Model.Result == Blackjack.Core.Models.GameResult.DealerWin)
    {
        vinst = -Model.BetAmount; // Förlorat hela insatsen!
    }
    else
    {
        vinst = Model.Payout - Model.BetAmount;
    }
    var vinstText = vinst > 0 ? $"+{vinst} kr" : vinst < 0 ? $"{vinst} kr" : "0 kr";
}

<h2>Blackjack</h2>
<p>Välkommen till Blackjack-projektet!</p>

@if (Model.PlayerHand == null || !Model.PlayerHand.Any())
{
    <form asp-action="Deal" method="post">
        <label for="bet">Insats:</label>
        <input type="number" name="bet" min="1" value="@Model.BetAmount" step="1" />
        <button type="submit">Dela ut kort</button>
    </form>
}
else
{
    <h3>Dina kort:</h3>
    <h4>Summa: <span id="playerValue">@Model.PlayerHandValue</span></h4>
    <ul>
        @foreach (var card in Model.PlayerHand)
        {
            <li>
                @{
                    string rankText = card.Rank == 1 ? "Ess"
                    : card.Rank == 11 ? "Knekt"
                    : card.Rank == 12 ? "Dam"
                    : card.Rank == 13 ? "Kung"
                    : card.Rank.ToString();
                }
                @($"{rankText} av {card.Suit}")
            </li>
        }
    </ul>

    @if (!Model.IsGameOver && Model.PlayerHand.Any() && @Model.PlayerHandValue < 21)
    {
        <h3>Dealerns första kort:</h3>
        <h4>Summa: <span id="dealerValue">@Model.DealerHandValue</span></h4>
        <ul>
            <li>
                @if (Model.DealerHand != null && Model.DealerHand.Any())
                {
                    string rankText = Model.DealerHand.First().Rank switch
                    {
                        1 => "Ess",
                        11 => "Knekt",
                        12 => "Dam",
                        13 => "Kung",
                        _ => Model.DealerHand.First().Rank.ToString()
                    };
                    @(rankText + " av " + Model.DealerHand.First().Suit)
                }
                else
                {
                    <text>Inga kort utdelade än.</text>
                }
            </li>
        </ul>
        <form asp-action="Hit" method="post">
            <button type="submit">Ta kort (Hit)</button>
        </form>
        <form asp-action="Stand" method="post">
            <button type="submit">Stanna (Stand)</button>
        </form>
    }
    else
    {
        <h3>Dealerns kort:</h3>
        <h4>Summa: <span id="dealerValue">@Model.DealerHandValue</span></h4>
        <ul>
            @foreach (var card in Model.DealerHand)
            {
                string rankText = card.Rank switch
                {
                    1 => "Ess",
                    11 => "Knekt",
                    12 => "Dam",
                    13 => "Kung",
                    _ => card.Rank.ToString()
                };
                <li>@(rankText + " av " + card.Suit)</li>
            }

        </ul>
        <h4>
            Resultat:
            @if (Model.PlayerHand.Count() == 2 && Model.PlayerHandValue == 21)
            {
                <span>Du fick blackjack!</span>
            }
            else if (Model.Result == Blackjack.Core.Models.GameResult.PlayerWin)
            {
                <span>Du vann!</span>
            }
            else if (Model.Result == Blackjack.Core.Models.GameResult.DealerWin && Model.Payout == 0)
            {
                <span>Dealern vann.</span>
            }
            else if (Model.Result == Blackjack.Core.Models.GameResult.Push)
            {
                <span>Oavgjort!</span>
            }
        </h4>
        <h4>Utbetalning: @Model.Payout kr</h4>
        <h4>Din vinst/förlust för handen: @vinstText</h4>
        <h4>Totalt resultat under sessionen: @(Model.SessionVinst > 0 ? "+" : "")@Model.SessionVinst kr</h4>
        <a asp-action="Index">Spela igen</a>
    }
}